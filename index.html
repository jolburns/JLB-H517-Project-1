<!DOCTYPE html>
<html>
<head>
	<title>Project 1 - John L Burns - Cholera Map</title>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<style>
    	text { 
			font-family: Arial; 
			font-size: 15px;
		}
		.axis path, .axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		.tick text {
			fill: black;
			font-size: 11px;
		}

		rect {
			stroke: white;
		}
	</style>
</head>
<body>

	<svg id="map" width="400" height="400">
		<text id='label' x='0' y='20'>1854 Broad Street Cholera Outbreak</text>
		<g transform="translate(30,40)"></g>
	</svg>

	
	<script>
		//setting up variables for later
		var map_width = 600;
		var map_height = 600;
		var street_start_stop = [];
		var pumps = [];
		
		//select the map svg
		var map_svg = d3.select("#map").attr("width", map_width).attr("height", map_height);
		
		//loading in streets.json and displaying the map
		d3.json('streets.json', function(data) 
		{
			// Loop through all objects
			for (i = 0; i < data.length; i++) 
			{
				for (j = 0; j < data[i].length - 1; j++)
				{
					x1 = parseFloat(data[i][j]['x'])
					y1 = parseFloat(data[i][j]['y'])
					x2 = parseFloat(data[i][j+1]['x'])
					y2 = parseFloat(data[i][j+1]['y'])
					street_start_stop.push([x1+0.06, y1+0.08, x2+0.06, y2+0.08]);
					street_start_stop.push([x1-0.06, y1-0.08, x2-0.06, y2-0.08]);
				}
			}
			
			//make the empty lines
			var map_lines = map_svg.selectAll('line').data(street_start_stop).enter().append('line');
			
			//functions to fix scaling
			var x_scale = d3.scale.linear().domain([0, d3.max(street_start_stop, function(sss) {return sss[0];})]).range([-50, map_width-100]);
			var y_scale = d3.scale.linear().domain([0, d3.max(street_start_stop, function(sss) {return sss[1];})]).range([map_height-50, 50]);
			
			//set x1/y1 for the lines
			map_lines.attr('x1', function(sss) {return x_scale(sss[0])}).attr('y1', function(sss) {return y_scale(sss[1])});
			//set x2/y2 for the lines
			map_lines.attr('x2', function(sss) {return x_scale(sss[2])}).attr('y2', function(sss) {return y_scale(sss[3])});
			
			//color in the lines
			map_lines.attr('stroke', "black");
		});
		
		
		//loading in pumps.csv and displaying them
		d3.csv("pumps.csv", function(data)
		{
			for(i = 0; i < data.length; i++)
			{
				pumps.push([i, data[i]['x'], data[i]['y']]);
			}
			//console.log(pumps);
			
			//functions to fix scaling
			var x_scale = d3.scale.linear().domain([0, d3.max(pumps, function(p) {return p[1];})]).range([-45, map_width-400]);
			var y_scale = d3.scale.linear().domain([0, d3.max(pumps, function(p) {return p[2];})]).range([map_height-53, 290]);
			
			//make the empty pump icons
			var pump_icons = map_svg.selectAll("circle").data(pumps).enter().append("circle")
			
			//set x/y for pumps
			pump_icons.attr("cx", function(p) {return x_scale(p[1]);}).attr("cy", function(p) {return y_scale(p[2]);}).attr("r", 4)
			
			pump_icons.attr("fill", "blue")
		});

		
		
	</script>
</body>


</html>
